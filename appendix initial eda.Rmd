---
title: "APPENDIX"
author: "Chuong Bao Thy Lai"
date: "2/8/2023"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, warning=FALSE, echo=FALSE,message=FALSE}
library(plyr)
library(dplyr)
library(ggplot2)
library(ggpubr)
library(forcats)
library(readxl)
library(ggpubr)
library(RColorBrewer)
data <- read_xlsx('TiresDataFile_DSCI490_W23.xlsx')
dat <- read_xlsx('TiresDataFile.xlsx')
```

\newpage 

# 3. Appendix

## 3.1 Preview 

```{r, warning=FALSE,message=FALSE, results='hide', fig.show='hide'}
dim(data)
# data summary
summary(data)
# detail of data
str(data)
# the total of missing data
sum(is.na(data))
# Check missing data in each column
dat %>%
  is.na() %>%
  colSums()
```

### Missing data
```{r, warning=FALSE,message=FALSE, results='hide', fig.show='hide'}
data %>%
is.na() %>%
reshape2::melt() %>%
ggplot(aes(Var2, Var1, fill=value)) +
geom_raster() +
coord_flip() +
scale_y_continuous(NULL, expand = c(0, 0)) +
scale_fill_grey(name = "",
labels = c("Present",
"Missing")) +
xlab("Observation") +
theme(axis.text.y = element_text(size = 4))
```

## 3.2 Categorical variables EDA 
### Visualization of income, household size, education and location
```{r fig.show='hide', message=FALSE, warning=FALSE, results='hide'}
a <- dat %>% 
  ggplot(aes(x = fct_infreq(Income))) +
    geom_bar(aes(fill = ..count..)) +
    geom_text(aes(label = ..count..), vjust = 1, stat = "count", colour = "black")+
  theme_pubclean() +labs(x="Income") +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.9, hjust=1),
        axis.text.y=element_blank(), axis.ticks.y=element_blank(),
        axis.title.x=element_blank())+
    scale_fill_distiller(palette = 1, guide = FALSE, direction = 1)

b <- dat %>% 
  ggplot(aes(x = fct_infreq(Household_size)))+
geom_bar(aes(fill = ..count..)) + 
   geom_text(aes(label = ..count..), vjust = 1, stat = "count", colour = "black")+
  theme_pubclean() +labs(x="House hold size") +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.9, hjust=1),
        axis.text.y=element_blank(), axis.ticks.y=element_blank(),
        axis.title.x=element_blank())+
scale_fill_distiller(palette = 1, guide = FALSE, direction = 1)

c <- dat %>% 
  ggplot(aes(x = fct_infreq(Education)))+
geom_bar(aes(fill = ..count..)) +
    geom_text(aes(label = ..count..), vjust = 1, stat = "count", colour = "black")+
  theme_pubclean() +labs(x="Education") +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.9, hjust=1),
        axis.text.y=element_blank(), axis.ticks.y=element_blank(),
        axis.title.x=element_blank())+
scale_fill_distiller(palette = 1, guide = FALSE, direction = 1)

d <- dat %>% 
  ggplot(aes(x = fct_infreq(Location)))+
geom_bar(aes(fill = ..count..)) +
    geom_text(aes(label = ..count..), vjust = 1, stat = "count", colour = "black")+
  theme_pubclean() +labs(x="Location") +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.9, hjust=1),
        axis.text.y=element_blank(), axis.ticks.y=element_blank(),
        axis.title.x=element_blank())+
scale_fill_distiller(palette = 1, guide = FALSE, direction = 1)
figure <- ggarrange(a, b, c, d,
                    ncol = 2, nrow = 2)
figure
```
### Visualization the vehicle variable

```{r, warning=FALSE,message=FALSE, results='hide', fig.show='hide'}
type  = c("Compact","Sedan","SUV","Truck","Van","Mini Van",
          "Compact","Sedan","SUV","Truck","Van","Mini Van",
          "Compact","Sedan","SUV","Truck","Van","Mini Van",
          "Compact","Sedan","SUV","Truck","Van","Mini Van")
name = c("Primary type", "Primary type","Primary type","Primary type","Primary
         type","Primary type",
         "2nd type", "2nd type","2nd type","2nd type","2nd type","2nd type", 
         "3rd type","3rd type","3rd type","3rd type","3rd type","3rd type", 
         "4th type","4th type","4th type","4th type","4th type","4th type")
value = c(227, 261, 301,263, 290,291,135,
          193,81,87,52,101,25,61,25,36,18,30,4,5,0,6,8,0)
df <- data.frame(type,name,value)
heat_map <- ggplot(df, aes(type, name)) + 
  geom_tile(aes(fill = value))+
  geom_text(aes(label =value), vjust = 1, colour = "white")

type1  = c("Compact","Sedan","SUV","Truck","Van","Mini Van")
value1 = c(391,452,520,407,391,368)
 df1 <- data.frame(type1,value1)
vehicle_bar <- df1 %>% ggplot(aes(x = type1, y= value1))+
geom_bar(stat="identity", fill="#CC79A7") +
  geom_text(aes(label = value1), vjust = 0.5, hjust = 1, colour = "black")+
coord_flip() +
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="none"
    )

        
```

### Visualization of discount code variable

```{r, warning=FALSE,message=FALSE, results='hide', fig.show='hide'}
dat %>% 
  ggplot(aes(x = fct_infreq(Dis_code)))+
geom_bar(aes(fill = ..count..)) +
    geom_text(aes(label = ..count..), vjust = 1, stat = "count", colour = "black")+
  theme_pubclean() +labs(x="Dis_code") +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.9, hjust=1))+
scale_fill_distiller(palette = 1, guide = FALSE, direction = 1)
```

### Visualization of complaints 
```{r, warning=FALSE,message=FALSE, results='hide', fig.show='hide'}
dat$Complaints <- as.factor(dat$Complaints)
dat$Complaints <- revalue(dat$Complaints, c("0"="No", "1"="Yes"))
dat %>%
  ggplot(aes(x=Complaints)) + geom_bar(fill="#CC79A7")+
    geom_text(aes(label = ..count..), vjust = 1, stat = "count", colour = "black")
```

### Visualization of warranty
```{r, warning=FALSE,message=FALSE, results='hide', fig.show='hide'}
dat$Warranty <- as.factor(dat$Warranty)
dat$Warranty <- revalue(dat$Warranty, c("0"="No", "1"="Yes"))
dat %>%
  ggplot(aes(x=Warranty)) + geom_bar(fill="#CC79A7")+ 
    geom_text(aes(label = ..count..), vjust = 1, stat = "count", colour = "black")
```

### Visualization of quality_rim
```{r, warning=FALSE,message=FALSE, results='hide', fig.show='hide'}
dat %>%
  ggplot(aes(x=Quality_rim)) + geom_bar(fill="#CC79A7")+
    geom_text(aes(label = ..count..), vjust = 1, stat = "count", colour = "black")
```

### Visualization of responded count
```{r, warning=FALSE,message=FALSE, results='hide', fig.show='hide'}

par( mfrow= c(2,3) )
coul <- brewer.pal(5, "Set2") 
dat$Feb_summer <- as.factor(dat$Feb_summer)
dat$Feb_summer <- revalue(dat$Feb_summer, c("0"="No", "1"="Yes"))
barplot(table(dat$Feb_summer),main="Reponded count in February",
xlab="Reponded",
ylab="Count",
border="red",
col=coul)

dat$Mar_all_seasons <- as.factor(dat$Mar_all_seasons)
dat$Mar_all_seasons <- revalue(dat$Mar_all_seasons, c("0"="No", "1"="Yes"))
barplot(table(dat$Mar_all_seasons),main="Reponded count in March",
xlab="Reponded",
ylab="Count",
border="red",
col=coul)

dat$June_all_seasons <- as.factor(dat$June_all_seasons)
dat$June_all_seasons <- revalue(dat$June_all_seasons, c("0"="No", "1"="Yes"))
barplot(table(dat$June_all_seasons),main="Reponded count in June",
xlab="Reponded",
ylab="Count",
border="red",
col=coul)

dat$Sep_winter <- as.factor(dat$Sep_winter)
dat$Sep_winter <- revalue(dat$Sep_winter, c("0"="No", "1"="Yes"))
barplot(table(dat$Sep_winter),main="Reponded count in September",
xlab="Reponded",
ylab="Count",
border="red",
col=coul)

dat$Nov_winter <- as.factor(dat$Nov_winter)
dat$Nov_winter <- revalue(dat$Nov_winter, c("0"="No", "1"="Yes"))
barplot(table(dat$Nov_winter),main="Reponded count in November",
xab="Reponded",
ylab="Count",
border="red",
col=coul)
```



## 3.3 Numeric variables EDA
### Visualization of age

```{r, warning=FALSE,message=FALSE, results='hide', fig.show='hide'}
par(mfrow = c(1,1))
e <- dat %>% ggplot(aes(Age)) +
  geom_boxplot() + coord_flip()
f <- dat %>% ggplot(aes(Age, fill = 'skyblue4')) + 
  geom_histogram(binwidth = 5) +
  theme(
      legend.position="none")
figure1 <- ggarrange(e,f,
                    ncol = 2, nrow = 1)
figure1
```

### Visualization of anual driving

```{r, warning=FALSE,message=FALSE, results='hide', fig.show='hide'}
plot(density(dat$Annual_driving),
    col="yellow",
    main="Density Plot for Annual driving",
    xlab="Annual driving",
    ylab="Density")
polygon(density(dat$Annual_driving),
        col="#ccff66")
```

### Visualization of the number of purchases in store and online
```{r, warning=FALSE,message=FALSE, results='hide', fig.show='hide'}
ins <- dat %>%
  ggplot(aes(x=Pur_in_store)) + geom_histogram(fill="#CC79A7")
onl <- dat %>%
  ggplot(aes(x=Pur_Online)) + geom_histogram(fill="#CC79A7")
ggarrange(ins,onl,ncol = 2, nrow = 1)
```

### Visualization of the number of driver
```{r, warning=FALSE,message=FALSE, results='hide', fig.show='hide'}
hist(dat$Driver,
  col="#660033",
  main="Histogram for number of driver",
  xlab="The number of driver in house",
  ylab="Frequency",
  labels=FALSE)
```

### Correlation variable
```{r, warning=FALSE,message=FALSE, results='hide', fig.show='hide'}
my_data <- dat[, c(1,3,5,8,9,10,11,12,19,20,21,41,42,43,38)]
M<-cor(my_data)
head(round(M,2))
library(corrplot)
corrplot(M, method="circle")
```
### Code obtain method in three types of 
```{r, warning=FALSE,message=FALSE, results='hide', fig.show='hide'}
sum <- dat %>%
  group_by(Code_obtained) %>%
  summarize(sum = Summer_tires) %>%
  ggplot(aes(x=Code_obtained, y=sum)) + geom_col(fill="skyblue4")
win <- dat %>%
  group_by(Code_obtained) %>%
  summarize(winter_sum = Winter_tires) %>%
  ggplot(aes(x=Code_obtained, y=winter_sum)) + geom_col(fill="skyblue4")
sea <- dat %>%
  group_by(Code_obtained) %>%
  summarize(all_seasons_sum = All_seasons) %>%
  ggplot(aes(x=Code_obtained, y=all_seasons_sum)) + geom_col(fill="skyblue4")
rim <- dat %>%
  group_by(Code_obtained) %>%
  summarize(rim_sum = Rim) %>%
  ggplot(aes(x=Code_obtained, y=rim_sum)) + geom_col(fill="skyblue4")
figur <- ggarrange(sum, win, sea, rim,
                    ncol = 2, nrow = 2)
figur
```
### Time series
```{r, warning=FALSE,message=FALSE, results='hide', fig.show='hide'}
library(ggplot2)
e <- ggplot(dat, aes(x = Summer_date, y =`Summer_tires`)) + 
  geom_smooth(method = 'auto', se = FALSE) + 
  labs(x = 'Year', y = 'Purchased set', title = 'Summer tire purchased over Time') + 
  theme(panel.grid.major = element_line(colour = NA),
    legend.text = element_text(colour = "skyblue4"),
    legend.title = element_text(face = "bold"),
    panel.background = element_rect(fill = NA),
    plot.background = element_rect(fill = "seashell1",
        colour = NA), legend.key = element_rect(fill = "gray71"),
    legend.background = element_rect(fill = NA))
w <- ggplot(dat, aes(x =All_seasons_date, y =`All_seasons`)) + 
  geom_smooth(method = 'auto', se = FALSE) + 
  labs(x = 'Year', y = 'Purchased set', title = 'All seasons purchased over Time') + 
  theme(panel.grid.major = element_line(colour = NA),
    legend.text = element_text(colour = "skyblue4"),
    legend.title = element_text(face = "bold"),
    panel.background = element_rect(fill = NA),
    plot.background = element_rect(fill = "seashell1",
        colour = NA), legend.key = element_rect(fill = "gray71"),
    legend.background = element_rect(fill = NA))

q <- ggplot(dat, aes(x = Winter_date, y =`Winter_tires`)) +
  geom_smooth(method = 'auto', se = FALSE) + 
  labs(x = 'Year', y = 'Purchased set', title = 'Winter tires purchased over Time') + 
  theme(panel.grid.major = element_line(colour = NA),
    legend.text = element_text(colour = "skyblue4"),
    legend.title = element_text(face = "bold"),
    panel.background = element_rect(fill = NA),
    plot.background = element_rect(fill = "seashell1",
        colour = NA), legend.key = element_rect(fill = "gray71"),
    legend.background = element_rect(fill = NA))

figure1 <- ggarrange(w,q,e,
                    ncol = 2, nrow = 2)
figure1
```
